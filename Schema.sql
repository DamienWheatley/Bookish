-- ---
-- Globals
-- ---

-- SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";
-- SET FOREIGN_KEY_CHECKS=0;

DROP TABLE IF EXISTS Books CASCADE;
DROP TABLE IF EXISTS Titles CASCADE;
DROP TABLE IF EXISTS Users CASCADE;
DROP TABLE IF EXISTS Loans CASCADE;

DROP TYPE IF EXISTS LoanStatus;
CREATE TYPE LoanStatus AS ENUM ('On Loan', 'In Library', 'Overdue');

-- Table 'Books'

CREATE TABLE Books (
  Book_ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  ISBN VARCHAR(17) NOT NULL DEFAULT 'NULL',
  On_Shelf BOOLEAN DEFAULT TRUE,
  PRIMARY KEY (Book_ID)
);

-- Table 'Titles'

CREATE TABLE Titles (
  ISBN VARCHAR(17) NOT NULL DEFAULT 'NULL' ,
  Title VARCHAR(500) NOT NULL DEFAULT 'NULL',
  Author VARCHAR(500) NOT NULL DEFAULT 'NULL',
  Genre VARCHAR(500) NOT NULL DEFAULT 'NULL',
  PRIMARY KEY (ISBN)
);

-- Table 'Loans'

CREATE TABLE Loans (
  loan_ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  User_ID INTEGER,
  Book_ID INTEGER,
  Loan_Date DATE,
  Return_Date DATE,
  Loan_Status LoanStatus,
  Fine_Amount NUMERIC NOT NULL DEFAULT 0,
  PRIMARY KEY (Loan_ID)
);


-- Table 'Users'

CREATE TABLE Users (
  User_ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  Forename VARCHAR(500) NOT NULL DEFAULT 'NULL',
  Surname VARCHAR(500) NOT NULL DEFAULT 'NULL',
  PRIMARY KEY (User_ID)
);


-- Foreign Keys

ALTER TABLE Books ADD FOREIGN KEY (ISBN) REFERENCES Titles (ISBN);
ALTER TABLE Loans ADD FOREIGN KEY (User_ID) REFERENCES Users (User_ID);
ALTER TABLE Loans ADD FOREIGN KEY (Book_ID) REFERENCES Books (Book_ID);
